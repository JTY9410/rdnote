{% extends "base.html" %}

{% block title %}회원가입 - WECar 연구개발일지{% endblock %}

{% block extra_css %}
<style>
    .register-wrapper {
        min-height: calc(100vh - 200px);
        padding: 40px 0;
    }
    .register-card {
        border-radius: 32px;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0,0,0,0.12);
        border: 1px solid rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(20px);
        background: rgba(255, 255, 255, 0.95);
    }
    .register-header {
        background: linear-gradient(135deg, #dc3545 0%, #b02a37 100%);
        color: white;
        padding: 40px;
        text-align: center;
    }
    .register-header h4 {
        font-size: 2rem;
        font-weight: 800;
        letter-spacing: -0.02em;
    }
    .section-title {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #e0e4e8;
    }
    #signatureCanvas {
        border: 2px solid #e0e4e8;
        border-radius: 16px;
        cursor: crosshair;
        transition: all 0.3s ease;
    }
    #signatureCanvas:hover {
        border-color: var(--primary-color);
    }
    .btn-submit {
        padding: 16px 40px;
        font-size: 1.1rem;
        font-weight: 700;
        border-radius: 14px;
    }
</style>
{% endblock %}

{% block content %}
<div class="register-wrapper">
    <div class="row justify-content-center">
        <div class="col-md-10 col-lg-8">
            <div class="card register-card">
                <div class="register-header">
                    <h4><i class="bi bi-person-plus"></i> 회원가입</h4>
                    <p class="mb-0 mt-2" style="opacity: 0.95;">연구개발일지에 합류하세요</p>
                </div>
                <div class="card-body p-5">
                    <form method="POST" action="{{ url_for('auth.register') }}">
                        <h5 class="section-title">기본 정보</h5>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="name" class="form-label fw-bold">이름 *</label>
                                <input type="text" class="form-control" id="name" name="name" required>
                            </div>
                            <div class="col-md-6">
                                <label for="email" class="form-label fw-bold">이메일 *</label>
                                <input type="email" class="form-control" id="email" name="email" required>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="password" class="form-label fw-bold">비밀번호 *</label>
                                <input type="password" class="form-control" id="password" name="password" required>
                            </div>
                            <div class="col-md-6">
                                <label for="password_confirm" class="form-label fw-bold">비밀번호 확인 *</label>
                                <input type="password" class="form-control" id="password_confirm" name="password_confirm" required>
                            </div>
                        </div>
                        
                        <h5 class="section-title mt-4">소속 정보</h5>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="org_name" class="form-label fw-bold">소속</label>
                                <input type="text" class="form-control" id="org_name" name="org_name">
                            </div>
                            <div class="col-md-6">
                                <label for="department" class="form-label fw-bold">부서</label>
                                <input type="text" class="form-control" id="department" name="department">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="researcher_code" class="form-label fw-bold">연구자번호</label>
                            <input type="text" class="form-control" id="researcher_code" name="researcher_code">
                        </div>
                        
                        <h5 class="section-title mt-4">전자서명</h5>
                        <div class="alert alert-warning border-0 mb-3" style="background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%); border-left: 4px solid #ffc107;">
                            <i class="bi bi-exclamation-triangle"></i> 전자서명은 PDF 승인에 사용됩니다. 미등록 시 PDF에서 서명이 비어 있을 수 있습니다.
                        </div>
                        <div class="mb-3">
                            <canvas id="signatureCanvas" width="400" height="200"></canvas>
                        </div>
                        <button type="button" class="btn btn-secondary btn-sm rounded mb-3" onclick="clearSignature()">
                            <i class="bi bi-eraser"></i> 지우기
                        </button>
                        <input type="hidden" id="signature_data" name="signature_data" />
                        
                        <h5 class="section-title mt-4">워크스페이스 설정</h5>
                        <div class="mb-3">
                            <div class="form-check form-check-lg">
                                <input class="form-check-input" type="checkbox" id="create_workspace" name="create_workspace">
                                <label class="form-check-label fw-bold" for="create_workspace">
                                    내 워크스페이스 자동 생성
                                </label>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label for="workspace_name" class="form-label fw-bold">워크스페이스명</label>
                            <input type="text" class="form-control" id="workspace_name" name="workspace_name" placeholder="내 워크스페이스">
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-submit w-100">
                            <i class="bi bi-check-circle"></i> 가입 신청
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const canvas = document.getElementById('signatureCanvas');
const ctx = canvas.getContext('2d');
let drawing = false;

canvas.addEventListener('mousedown', startDrawing);
canvas.addEventListener('mousemove', draw);
canvas.addEventListener('mouseup', stopDrawing);
canvas.addEventListener('mouseout', stopDrawing);

function startDrawing(e) {
    drawing = true;
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    ctx.beginPath();
    ctx.moveTo(x, y);
}

function draw(e) {
    if (!drawing) return;
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    ctx.lineTo(x, y);
    ctx.stroke();
}

function stopDrawing() {
    drawing = false;
    saveSignature();
}

function clearSignature() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    document.getElementById('signature_data').value = '';
}

function saveSignature() {
    const dataURL = canvas.toDataURL('image/png');
    document.getElementById('signature_data').value = dataURL;
}

// Set initial style
ctx.strokeStyle = '#000';
ctx.lineWidth = 2;
</script>
{% endblock %}

